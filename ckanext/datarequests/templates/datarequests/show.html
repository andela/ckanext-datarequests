{% extends "datarequests/base.html" %}

{% block title %}Data Request {{c.datarequest.get('title', '')}}{% endblock %}
{% set datarequest_id = c.datarequest.get('id') %}
{% set rating = c.datarequest.get('rating') %}
{% set user_option = c.datarequest.get('user_option') %}

{% block breadcrumb_content %}
  <li>{% link_for _('Data Requests'), controller='ckanext.datarequests.controllers.ui_controller:DataRequestsUI', action='index' %}</li>
  <li>{% link_for c.datarequest.get('title'), controller='ckanext.datarequests.controllers.ui_controller:DataRequestsUI', action='show', id=datarequest_id %}</li>
{% endblock %}

{% block content_action %}

  {% if h.check_access('datarequest_update', {'id':datarequest_id }) %}
    {% link_for _('Manage'), controller='ckanext.datarequests.controllers.ui_controller:DataRequestsUI', action='update', id=datarequest_id, class_='btn', icon='wrench' %}
  {% endif %}

  {% if h.check_access('datarequest_close', {'id':datarequest_id }) and not c.datarequest.closed %}
    {% link_for _('Close'), controller='ckanext.datarequests.controllers.ui_controller:DataRequestsUI', action='close', id=datarequest_id, class_='btn btn-danger', icon='lock' %}
  {% endif %}

{% endblock %}

{% block content_primary_nav %}
  {{ h.build_nav_icon('datarequest_show', _('Data Request'), id=datarequest_id) }}

  {% if h.show_comments_tab() %}
    {{ h.build_nav_icon('datarequest_comment', _('Comments') + ' ' + h.get_comments_badge(datarequest_id), id=datarequest_id) }}
  {% endif %}
{% endblock %}

{% block secondary_content %}
  {{ super() }}

  {% block package_social %}
    {% snippet "snippets/social.html" %}
  {% endblock %}

{% endblock %}

{% block primary_content_inner %}
    {% if c.datarequest.closed %}
      <span class="uppercase label label-closed pull-right">
        <i class="icon-lock fa fa-lock"></i>
        {{ _('Closed') }}
      </span>
    {% else %}
      <span class="uppercase label label-open pull-right">
        <i class="icon-unlock fa fa-unlock"></i>
        {{ _('Open') }}
      </span>
    {% endif %}

  <h1 class="{% block page_heading_class %}page-heading{% endblock %}">{% block page_heading %}{{ c.datarequest.get('title') }}{% endblock %}</h1>

  <hr class="title-separator">

  <div>
  
  <div class="main-info">
  {% block datarequest_description %}
    {% if c.datarequest.get('description') %}
      <div class="notes embedded-content">
        {{ h.render_markdown(c.datarequest.get('description')) }}
      </div>
    {% endif %}
  {% endblock %}

  {% block datarequest_additional_info %}
    {% snippet "datarequests/snippets/additional_info.html", datarequest=c.datarequest %}
  {% endblock %}
  </div>
  
  <!-- Votes section -->
  <div class="vote-section" id="datarequest_vote_section" data-datarequest-id="{{ c.datarequest.get('id') }}" data-user-option="{{ user_option }}">
      <!-- <h3> Rating </h3> -->
      {% if user_option == True %}
  
        <div class= "vote-section-content up_vote">
          <i class= "icon-caret-up icon-3x" style="color: orange" title="Up vote request" id="arrow_up"></i>
        </div>
  
        <div class="vote-section-content rating">
          <div class="vote-section-content" id="rating"> {{ rating }} </div>
        </div>
  
        <div class="vote-section-content down_vote">
          <i class= "icon-caret-down icon-3x disabled" title="Down vote request" id="arrow_down"></i>
        </div>      
  
      {% elif user_option == False %}
  
        <div class= "vote-section-content up_vote">
          <i class= "icon-caret-up icon-3x disabled" title="Up vote request" id="arrow_up"></i>
        </div>
  
        <div class="vote-section-content rating">
          <div class="vote-section-content" id="rating"> {{ rating }} </div>
        </div>
  
        <div class="vote-section-content down_vote">
          <i class= "icon-caret-down icon-3x" style="color: orange" title="Down vote request" id="arrow_down"></i>
        </div>
  
      {% else %}
  
        
        <div class= "vote-section-content up_vote">
          <i class= "icon-caret-up icon-3x" title="Up vote request" id="arrow_up"></i>
        </div>
  
        <div class="vote-section-content rating">
          <div class="vote-section-content" id="rating"> {{ rating }} </p>
        </div>
  
        <div class="vote-section-content down_vote">
          <i class= "icon-caret-down icon-3x" title="Down vote request" id="arrow_down"></i>
        </div>
  
      {% endif %}
    </div>
  <!-- End of votes section -->

  <div>
{% endblock %}
